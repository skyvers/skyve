// fLAB.js (file:// protocol adapter for LABjs 1.0+) | v0.2 (c) Kyle Simpson | MIT License
(function(m){var t=m.$LAB,u=m.document,C=u.location,L=(C.protocol==="file:");if(!t||!L)return;var h="undefined",j="string",o="head",v="body",M="function",D="script",E="srcuri",N="done",p="which",w=true,k=false,F=m.setTimeout,x=function(b){return u.getElementsByTagName(b)},O=Object.prototype.toString,G=function(){},q={},y={},H=/^[^?#]*\//.exec(C.href)[0],P=/^file:\/\/(localhost)?(\/[a-z]:)?/i.exec(H)[0],Q=x(D),R=!+"\v1",I=R,r={dupe:k,preserve:k,base:"",which:o};q[o]=x(o);q[v]=x(v);function s(b,c){if(typeof b!==j)b="";if(typeof c!==j)c="";var a=(/^file\:\/\//.test(b)?"":c)+b;return((/^file\:\/\//.test(a)?"":(a.charAt(0)==="/"?P:H))+a)}function S(b){var c=0,a;while(a=Q[c++]){if(typeof a.src===j&&b===s(a.src))return w}return k}function z(l){if(typeof l===h)l=r;var Y=k,T=l.which,U=l.base,Z=G,V=k,n,A={},i=null;function W(a,e,d,f){if(q[a[p]][0]===null){F(arguments.callee,25);return}var g=u.createElement(D),B=function(b,c){g.setAttribute(b,c)};B("type",d);if(typeof f===j)B("charset",f);B("src",e);q[a[p]][0].appendChild(g)}function X(b){if(typeof b.allowDup===h)b.allowDup=l.dupe;var c=b.src,a=b.type,e=b.charset,d=b.allowDup,f=s(c,U),g;if(typeof a!==j)a="text/javascript";if(typeof e!==j)e=null;d=!(!d);if(!d&&((typeof y[f]!==h&&y[f]!==null)||S(f))){return}if(typeof A[f]===h)A[f]={};g=A[f];if(typeof g[p]===h)g[p]=T;g[N]=k;g[E]=f;V=w;y[g[E]]=w;W(g,f,a,e)}function J(b){var c=[],a;for(a=0;a<b.length;a++){if(O.call(b[a])==="[object Array]")c=c.concat(J(b[a]));else c[c.length]=b[a]}return c}n={script:function(){var b=J(arguments),c,a;for(a=0;a<b.length;a++){if(typeof b[a]===j)b[a]={src:s(b[a])};else if(typeof b[a].src!==h)b[a].src=s(b[a].src)}if(I){c=n;for(a=0;a<b.length;a++)X(b[a])}else{if(i===null)i=t.setOptions(l.pubMap);c=i=i.script.apply(null,b)}return c},wait:function(b){var c;if(typeof b!==M)b=G;if(I){c=n;F(b,0)}else{if(i===null)i=t.setOptions(l.pubMap);c=i=i.wait(b)}return c}};n.block=n.wait;return n}function K(b){var c,a={},e={"AlwaysPreserveOrder":"preserve","AllowDuplicates":"dupe"},d={"AppendTo":"which","BasePath":"base"};for(c in e)d[c]=e[c];for(c in d){if(d.hasOwnProperty(c)&&typeof r[d[c]]!==h)a[d[c]]=(typeof b[c]!==h)?b[c]:r[d[c]]}for(c in e){if(e.hasOwnProperty(c))a[e[c]]=!(!a[e[c]])}a.preload=a.cache=a.order=a.xhr=k;a.which=(a.which===o||a.which===v)?a.which:o;a.pubMap={};for(c in d){if(d.hasOwnProperty(c))a.pubMap[c]=a[d[c]]}return a}m.$LAB={setGlobalDefaults:function(b){r=K(b)},setOptions:function(b){return z(K(b))},script:function(){return z().script.apply(null,arguments)},wait:function(){return z().wait.apply(null,arguments)}};m.$LAB.block=m.$LAB.wait})(window);