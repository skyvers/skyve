SKYVE.BizMap=function(){var k={},e=new Wkt.Wkt,g=function(a,c){if(!a._refreshing){a._refreshing=!0;var b="";if("lazy"===a.loading){var d=a.webmap.getBounds();d&&(e.fromObject(d.getNorthEast()),b="&_ne="+e.write(),e.fromObject(d.getSouthWest()),b+="&_sw="+e.write())}$.get(a.url+b,function(h){try{SKYVE.GMap.scatter(a,h,c,!0)}finally{a._refreshing=!1}})}};return{create:function(a){var c={zoom:1,center:new google.maps.LatLng(0,0),mapTypeId:eval(SKYVE.Util.mapLayers)},b=k[a.elementId];b?(b.webmap&&(c.zoom=
b.webmap.getZoom(),c.center=b.webmap.getCenter(),c.mapTypeId=b.webmap.getMapTypeId()),b._intervalId&&(clearInterval(b._intervalId),b._intervalId=null)):(b={_objects:null,refreshTime:a.refreshTime,loading:a.loading,_refreshRequired:!0,_refreshing:!1,_intervalId:null,click:function(l,m){SKYVE.BizMap.click(this,l,m)},rerender:function(){g(this,!1)},moduleName:a.moduleName,queryName:a.queryName,geometryBinding:a.geometryBinding,documentName:a.documentName,modelName:a.modelName},k[a.elementId]=b);var d=
!1;if(b.documentName){var h=b.moduleName+"_"+b.documentName+"_"+b.modelName,f=sessionStorage.getItem(h);f&&(d=!0,f=JSON.parse(f),c.center=f.centre,c.zoom=f.zoom,sessionStorage.removeItem(h))}else if(h=b.moduleName+"_"+b.queryName+"_"+b.geometryBinding,f=sessionStorage.getItem(h))d=!0,f=JSON.parse(f),c.center=f.centre,c.zoom=f.zoom,sessionStorage.removeItem(h);b._objects={};b.infoWindow=new google.maps.InfoWindow({content:""});b.webmap=new google.maps.Map(SKYVE.PF.getByIdEndsWith(a.elementId)[0],c);
a.showRefresh&&SKYVE.GMap.refreshControls(b);"lazy"===a.loading&&(google.maps.event.addListener(b.webmap,"zoom_changed",function(){b._refreshing||g(b,!1)}),google.maps.event.addListener(b.webmap,"dragend",function(){g(b,!1)}));c=SKYVE.Util.CONTEXT_URL+"map?";a.modelName?c+="_c="+a._c+"&_m="+a.modelName:a.queryName&&(c+="_mod="+a.moduleName+"&_q="+a.queryName+"&_geo="+a.geometryBinding);b.url=c;g(b,!d);0<b.refreshTime&&b._refreshRequired&&(b._intervalId=setInterval(b.rerender.bind(b),1E3*b.refreshTime));
return b},get:function(a){return k[a]},click:function(a,c,b){a.documentName?sessionStorage.setItem(a.moduleName+"_"+a.documentName+"_"+a.modelName,'{"centre":'+JSON.stringify(a.webmap.getCenter().toJSON())+',"zoom":'+a.webmap.getZoom()+"}"):sessionStorage.setItem(a.moduleName+"_"+a.queryName+"_"+a.geometryBinding,'{"centre":'+JSON.stringify(a.webmap.getCenter().toJSON())+',"zoom":'+a.webmap.getZoom()+"}");var d=c.infoMarkup;d+='<br/><br/><input type="button" value="Zoom" onclick="window.location=\''+
SKYVE.Util.CONTEXT_URL;d+="?m="+c.mod+"&d="+c.doc+"&i="+c.bizId+"'\"/>";c.getPosition?(a.infoWindow.open(a.webmap,c),a.infoWindow.setContent(d)):c.getPath&&(a.infoWindow.setPosition(b.latLng),a.infoWindow.open(a.webmap),a.infoWindow.setContent(d))},resizeAll:function(){}}}();
SKYVE.BizMapPicker=function(){var k={};new Wkt.Wkt;return{create:function(e){var g={zoom:SKYVE.Util.mapZoom,center:SKYVE.GMap.centre(),mapTypeId:eval(SKYVE.Util.mapLayers),mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},a=k[e.elementId];a?a.webmap&&(g.zoom=a.webmap.getZoom(),g.center=a.webmap.getCenter(),g.mapTypeId=a.webmap.getMapTypeId()):(a={_overlays:[],setFieldValue:function(b){var d=SKYVE.PF.getTextElement(c+"_value");d.val(b);d.change()}},k[e.elementId]=a);var c=
SKYVE.PF.getByIdEndsWith(e.elementId).attr("id");a.webmap=new google.maps.Map(document.getElementById(c),g);e.disabled||(SKYVE.GMap.drawingTools(a),SKYVE.GMap.geoLocator(a));SKYVE.GMap.clear(a);e=SKYVE.PF.getTextElement(c+"_value");e.attr("readonly",!0);SKYVE.GMap.scatterValue(a,e.val())},resizeAll:function(){}}}();
