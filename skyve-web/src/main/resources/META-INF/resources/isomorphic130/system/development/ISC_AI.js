/*

  SmartClient Ajax RIA system
  Version v13.0p_2023-11-09/LGPL Development Only (2023-11-09)

  Copyright 2000 and beyond Isomorphic Software, Inc. All rights reserved.
  "SmartClient" is a trademark of Isomorphic Software, Inc.

  LICENSE NOTICE
     INSTALLATION OR USE OF THIS SOFTWARE INDICATES YOUR ACCEPTANCE OF
     ISOMORPHIC SOFTWARE LICENSE TERMS. If you have received this file
     without an accompanying Isomorphic Software license file, please
     contact licensing@isomorphic.com for details. Unauthorized copying and
     use of this software is a violation of international copyright law.

  DEVELOPMENT ONLY - DO NOT DEPLOY
     This software is provided for evaluation, training, and development
     purposes only. It may include supplementary components that are not
     licensed for deployment. The separate DEPLOY package for this release
     contains SmartClient components that are licensed for deployment.

  PROPRIETARY & PROTECTED MATERIAL
     This software contains proprietary materials that are protected by
     contract and intellectual property law. You are expressly prohibited
     from attempting to reverse engineer this software or modify this
     software for human readability.

  CONTACT ISOMORPHIC
     For more information regarding license rights and restrictions, or to
     report possible license violations, please contact Isomorphic Software
     by email (licensing@isomorphic.com) or web (www.isomorphic.com).

*/

if(window.isc&&window.isc.module_Core&&!window.isc.module_AI){isc.module_AI=1;isc._moduleStart=isc._AI_start=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc._moduleEnd&&(!isc.Log||(isc.Log&&isc.Log.logIsDebugEnabled('loadTime')))){isc._pTM={message:'AI load/parse time: '+(isc._moduleStart-isc._moduleEnd)+'ms',category:'loadTime'};if(isc.Log&&isc.Log.logDebug)isc.Log.logDebug(isc._pTM.message,'loadTime');else if(isc._preLog)isc._preLog[isc._preLog.length]=isc._pTM;else isc._preLog=[isc._pTM]}isc.definingFramework=true;if(window.isc&&isc.version!="v13.0p_2023-11-09/LGPL Development Only"&&!isc.DevUtil){isc.logWarn("SmartClient module version mismatch detected: This application is loading the core module from SmartClient version '"+isc.version+"' and additional modules from 'v13.0p_2023-11-09/LGPL Development Only'. Mixing resources from different SmartClient packages is not supported and may lead to unpredictable behavior. If you are deploying resources from a single package you may need to clear your browser cache, or restart your browser."+(isc.Browser.isSGWT?" SmartGWT developers may also need to clear the gwt-unitCache and run a GWT Compile.":""))}
if(isc.Canvas&&isc.Canvas.getPrototype().getUISummary==null){isc.A=isc.Canvas.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254k=["canDrag","canDragReposition","canDragScroll","canDragResize","canDrop","canAcceptDrop","canDropBefore","canEdit"];isc.A.$254l=["implicitCriteria"];isc.A.$254m=["name","title","type","editorType","canEdit","canFilter","canSave","canReorder","multiple","canDragResize","optionCriteria"];isc.B.push(isc.A.getUISummary=function isc_Canvas_getUISummary(_1,_2){var _3=[];_3.addList(_1);_3.addList(_2);var _4={id:this.getID(),smartClientComponentType:this.getScClassName()};var _5,_6=this.$254k;for(var i=0;i<_6.length;i++){var _8=_6[i];if(this.hasOwnProperty(_8)&&this[_8]!==_5&&!_3.contains(_8))
{_4[_8]=this[_8]}}
if(!_3.contains("children")){this.$254n(_4,"children",_3,_1)}
var _9=this.getAriaState();if(_9&&!isc.isAn.emptyObject(_9)){_4.ariaState=_9}
if(this.ariaRole)_4.ariaRole=this.ariaRole;if(!isc.isA.DataBoundComponent(this))return _4;var _10=this.getDataSource();if(_10){_4.dataSource=_10.getID();var _11=this.getCriteria();if(_11&&!isc.isAn.emptyObject(_11)){_4.criteria=_11}}
var _12=this,_13=this.getDataAsList();if(_13&&!_3.contains("data")){_13=_13.map(function(_19){return _12.getCleanRecordData(_19)});if(_13.length==1)_13=_13[0];_4.data=_13}
var _14=this.$254l;for(var i=0;i<_14.length;i++){var _8=_14[i];if(this.hasOwnProperty(_8)&&!isc.isAn.emptyObject(this[_8])){_4[_8]=isc.shallowClone(this[_8])}}
var _15=this.getFields&&this.getFields();if(_15){var _16=[];for(var i=0;i<_15.length;i++){var _17=_15[i],_18=_10?_10.getField(_17.name):null;if(_17.featureField)continue;_16.add(this.$254o(_17,_18))}
_4.fields=_16}
return _4},isc.A.$254n=function isc_Canvas__addChildrenToUISummary(_1,_2,_3,_4){if(this[_2]){var _5=[];for(var i=0;i<this[_2].length;i++){var _7=this[_2][i];for(var j=0;j<_3.length;j++){if(this[_3[j]]==_7)break}
if(j<_3.length)continue;if(_7.isVisible()&&!_7._generated){_5.add(_7.getUISummary(_4))}}
if(_5.length)_1[_2]=_5}},isc.A.$254o=function isc_Canvas__getFieldUISummary(_1,_2){var _3={};var _4,_5=this.$254m;for(var i=0;i<_5.length;i++){var _7=_5[i];if(_1.hasOwnProperty(_7)&&_1[_7]!==_4&&(_7=="name"||!_2||_2[_7]!=_1[_7]))
{_3[_7]=isc.shallowClone(_1[_7])}}
var _8=_1.optionDataSource;if(_8){if(isc.isA.DataSource(_8))_8=_8.getID();_3.dataSource=_8}
return _3},isc.A.getFirstDBC=function isc_Canvas_getFirstDBC(){return isc.Canvas.getFirstDBC(this)});isc.B._maxIndex=isc.C+4;isc.A=isc.Canvas;isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.B.push(isc.A.getFirstDBC=function isc_c_Canvas_getFirstDBC(_1){_1=_1;if(isc.isA.DataBoundComponent(_1))return _1;var _2=_1.members||_1.children,_3=_2?isc.Canvas.$2548(_2):null;if(_3){isc.logInfo("getFirstDBC() using child canvas "+_3+" since "+_1+" isn't a DataBoundComponent")}
return _3},isc.A.$2548=function isc_c_Canvas__getFirstDBC(_1){var _2=[];for(var i=0;i<_1.length;i++){var _4=_1[i];if(isc.isA.DataBoundComponent(_4)&&(!isc.DynamicForm||!isc.isA.SearchForm()))
{return _4}
_2.addList(_4.members||_4.children)}
return _2.length?isc.Canvas.$2548(_2):null});isc.B._maxIndex=isc.C+2}
if(isc.Layout&&isc.Layout.getPrototype().getUISummary==null){isc.A=isc.Layout.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254k=isc.Layout.$254j(["canDropComponents"]);isc.B.push(isc.A.getUISummary=function isc_Layout_getUISummary(_1,_2){_2=_2||[];_2.add("children");var _3=this.Super("getUISummary",[_1,_2]);var _4=[];_4.addList(_1);_4.addList(_2);if(!_4.contains("members")){this.$254n(_3,"members",_4,_1)}
return _3});isc.B._maxIndex=isc.C+1}
if(isc.SplitPane&&isc.SplitPane.getPrototype().getUISummary==null){isc.A=isc.SplitPane.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254r=["navigationPane","listPane","detailsPane"];isc.A.$254k=isc.SplitPane.$254j(["autoNavigate"]);isc.B.push(isc.A.getUISummary=function isc_SplitPane_getUISummary(_1,_2){var _3=this.Super("getUISummary",arguments);var _4=this.$254r;for(var i=0;i<_4.length;i++){var _6=this[_4[i]];if(!isc.isA.Canvas(_6))continue;if(_6.isVisible()&&!_6._generated){var _7=_6.getUISummary(_1);if(_3.members){_3.members.removeWhere("id",_6.getID())}
_3[_4[i]]=_7}}
if(_3.members&&!_3.members.length){delete _3.members}
return _3});isc.B._maxIndex=isc.C+1}
if(isc.TabSet&&isc.TabSet.getPrototype().getUISummary==null){isc.A=isc.TabSet.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254k=isc.TabSet.$254j(["canCloseTabs","canEditTabTitles","canReorderTabs"]);isc.A.$254s=["name","title","canClose","canEditTitle","canReorder","disabled"];isc.B.push(isc.A.getUISummary=function isc_TabSet_getUISummary(_1,_2){var _3=this.Super("getUISummary",arguments);var _4=this.tabs;if(_4){var _5=[];for(var i=0;i<_4.length;i++){var _7=_4[i];if(this.tabIsVisible(_7)){var _8=this.$254t(_7,_1);if(_3.children&&_8.pane){_3.children.removeWhere("id",_8.pane.id)}
_5.add(_8)}}
_3.tabs=_5}
if(_3.children&&!_3.children.length){delete _3.children}
return _3},isc.A.$254t=function isc_TabSet__getTabUISummary(_1,_2){var _3={};var _4,_5=this.$254s;for(var i=0;i<_5.length;i++){var _7=_5[i];if(_1.hasOwnProperty(_7)&&_1[_7]!==_4){_3[_7]=_1[_7]}}
var _8=_1.pane;if(isc.isA.Canvas(_8)){_3.pane=_8.getUISummary(_2)}
return _3});isc.B._maxIndex=isc.C+2}
if(isc.ListGrid&&isc.ListGrid.getPrototype().getUISummary==null){isc.A=isc.ListGrid.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254k=isc.ListGrid.$254j(["canAcceptDroppedRecords","canCollapseGroup","canDragRecordsOut","canExpandRecords","canGroupBy","isGrouped","canReorderRecords","canReorderFields","canResizeFields"]);isc.B.push(isc.A.getUISummary=function isc_ListGrid_getUISummary(_1,_2){_2=_2||[];_2.add("body");var _3=[];_3.addList(_1);_3.addList(_2);var _4=_3.contains("data");if(!_4)_2.add("data");var _5=this.Super("getUISummary",[_1,_2]);if(_5.canDragRecordsOut||_5.canReorderRecords){delete _5.canDrop;delete _5.canDrag}
if(_5.canAcceptDroppedRecords||_5.canReorderRecords){delete _5.canAcceptDrop}
if(this.data){_5.totalRows=this.getTotalRows();var _6=this.getDrawArea();if(_6){_5.startRow=_6[0];_5.endRow=_6[1];if(!_4){var _7=_5.data=this.data.getRange(_5.startRow,_5.endRow+1);for(var i=0;i<_7.length;i++){_7[i]=this.getCleanRecordData(_7[i])}}}}
return _5});isc.B._maxIndex=isc.C+1}
if(isc.SectionStack&&isc.SectionStack.getPrototype().getUISummary==null){isc.A=isc.SectionStack.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$254k=isc.SectionStack.$254j(["canCloseSections","canCollapseAll","canReorderSections"]);isc.A.$254p=["name","title","canClose","canReorder","canCollapse","canDropBefore"];isc.B.push(isc.A.getUISummary=function isc_SectionStack_getUISummary(_1,_2){var _3=this.Super("getUISummary",arguments);var _4=this.sections;if(_4){var _5=[];for(var i=0;i<_4.length;i++){var _7=_4[i];if(this.sectionIsVisible(_7)){var _8=this.$254q(_7,_1);if(_3.members&&_8.items){var _9=_8.items;for(var j=0;j<_9.length;j++){_3.members.removeWhere("id",_9[j].id)}}
_5.add(_8)}}
_3.sections=_5}
if(_3.members&&!_3.members.length){delete _3.members}
return _3},isc.A.$254q=function isc_SectionStack__getSectionUISummary(_1,_2){var _3={};var _4,_5=this.$254p;for(var i=0;i<_5.length;i++){var _7=_5[i];if(_1.hasOwnProperty(_7)&&_1[_7]!==_4){_3[_7]=_1[_7]}}
var _8=_1.items,_9=[];for(var i=0;i<_8.length;i++){var _10=_8[i];if(isc.isA.Canvas(_10)&&_10.isVisible()&&!_10._generated){_9.add(_10.getUISummary(_2))}}
if(_9.length){_3.items=_9}
return _3});isc.B._maxIndex=isc.C+2}
if(isc.NavPanel&&isc.NavPanel.getPrototype().getUISummary==null){isc.A=isc.NavPanel.getPrototype();isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.$2545=["title","isHeader"];isc.B.push(isc.A.getUISummary=function isc_NavPanel_getUISummary(_1,_2){var _3=this.Super("getUISummary",arguments);_3.navItems=this.$2546(this.navItems);var _4=this.currentItemId;if(_4)_3.currentItemId=_4;if(this.navDeck){var _5=this.navDeck.currentPane;if(_5&&_5.isVisible()){_3.currentItemPane=_5.getUISummary(_1)}}
var _6=this.navLayout;if(_6){var _7=[],_8=[],_9=this.navGrid;for(var i=0;i<_6.members;i++){var _11=_6.members[i];if(_11==_9)_9=null;else{if(_11&&_11.isVisible()&&!_11._generated){var _12=_11.getUISummary(_1);if(_9)_7.add(_12);else _8.add(_12)}}}
if(_7.length)_3.navBeforeMembers=_7;if(_8.length)_3.navAfterMembers=_8}
return _3},isc.A.$2546=function isc_NavPanel__getNavItemsUISummary(_1){var _2=[];for(var i=0;i<_1.length;i++){var _4=_1[i];_2.add(this.$2547(_4))}
return _2},isc.A.$2547=function isc_NavPanel__getNavItemUISummary(_1){var _2={};var _3,_4=this.$2545;for(var i=0;i<_4.length;i++){var _6=_4[i];if(_1.hasOwnProperty(_6)&&_1[_6]!==_3){_2[_6]=_1[_6]}}
var _7=isc.NavPanel.$167h(_1);if(_7)_2.id=_7;var _8=_1.items;if(_8&&_8.length){_2.items=this.$2546(_8)}
return _2});isc.B._maxIndex=isc.C+3}
if(!isc.AI)isc.defineClass("AI");isc.A=isc.AI;isc.A.exampleResponseDelineator="$$$$$$$";isc.A.aiResponseDelineator="#######";isc.A.scPostDelineator="^^^^^^^";isc.A=isc.AI;isc.A.responseTypes=["Execute JavaScript","Clarify","Inspect","Explain Why Not","Ad Hoc UI","Send A Message"];isc.A.messageTypes=["Notify","Modal Message"];isc.A.errorTypes={"ContainsAIDelineator":"The Response should not contain "+isc.AI.aiResponseDelineator+" or "+isc.AI.scPostDelineator,"NoResponseType":"The Response has no ResponseType, which is invalid.","BadResponseType":"The Response has ResponseType ${responseType}, which is not a valid ResponseType.","NoMessageType":"The Response has a Message but there is no MessageType, which is invalid.","BadMessageType":"The Response has MessageType ${messageType}, which is not a valid MessageType.","NoMessage":"ResponseType is ${responseType} but there is no Message in the Response, which is invalid.","NoJavaScript":"ResponseType is ${responseType} but there is no JavaScript in the Response, which is invalid.","NoCommandComplete":"ResponseType is ${responseType} but the JavaScript code in the Response does not contain a call to isc.AI.commandComplete(). This method should be invoked exactly once when the script's actions are completed","JavaScriptError":"Your attempt to execute JavaScript in the user's session resulted in a JavaScript error.\nThe error message is as follows:\n    ${error.message}\nEnd of error message.\n${hint}The attempted changes have been reverted and no messages have been displayed to the end user.\nPlease provide a revised response in the same format previously described."};isc.A=isc.AI;isc.B=isc._allFuncs;isc.C=isc.B._maxIndex;isc.D=isc._funcClasses;isc.D[isc.C]=isc.A.Class;isc.A.engines=[{name:"gpt35",model:"gpt-3.5-turbo",apiKey:null},{name:"gpt4",model:"gpt-4",apiKey:null}];isc.A.defaultEngine="gpt35";isc.A.assistantKey={altKey:true,keyName:"J"};isc.A.summaryCache=[];isc.A.requestAIParaphraseIntro="Please give me a ${detail} rephrased version of the following text:\n";isc.A.requestAISummaryIntro="Please generate a ${detail} summary of some the following text:\n";isc.A.sendPromptMaxRetries=2;isc.A.sendPromptRetryDelay=5000;isc.A.useClientSessionHistory=true;isc.A.adjacentValidationFailureCount=0;isc.A.$2542=0;isc.A.canExport=true;isc.A.canExportCharts=true;isc.A.canExportGrids=true;isc.A.canSaveScreens=true;isc.A.adHocUIWindowDefaults={_constructor:"Window",width:"80%",height:"80%",canDragResize:true,canDragReposition:true,keepInParentRect:false,autoCenter:true,isModal:true,title:"AI created User Interface",bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},toolStripDefaults:{_constructor:"ToolStrip",autoDraw:false,width:"100%",height:40},helpButtonDefaults:{_constructor:"ToolStripButton",autoDraw:false,name:"helpWithUI",icon:"[SKINIMG]actions/help.png",prompt:"Ask for help with the dynamically created UI",click:function(){}},saveButtonDefaults:{_constructor:"ToolStripButton",autoDraw:false,name:"helpWithUI",icon:"[SKINIMG]actions/save.png",prompt:"Save this UI for future use",click:function(){this.creator.saveAdHocUI()}},exportButtonDefaults:{_constructor:"ToolStripButton",name:"exportUI",icon:"[SKINIMG]actions/export.png",click:function(){this.creator.exportUI()}},initWidget:function(){this.addAutoChild("helpButton");this.addAutoChild("saveButton",{showIf:"isc.AI.canSaveScreens"});this.addAutoChild("exportButton",{showIf:"isc.AI.canExport"});this.addAutoChild("toolStrip",{members:[this.helpButton,this.saveButton,this.exportButton]});this.addItem(this.toolStrip);return this.Super("initWidget",arguments)},showCloseButton:true,showMinimizeButton:false,showMaximizeButton:true,closeClick:function(){this.destroy()},setAdHocUI:function(_1,_2){this.adHocUI=isc.isAn.Array(_1)?_1[0]:_1;this.response=_2;var _3=this.adHocUI&&this.adHocUI.getFirstDBC();if(!_3){this.exportButton.hide()}else{this.exportButton.show();this.exportButton.prompt=isc.isA.ListGrid(_3)?"Export Grid Data":"Export Chart"}
this.firstDBC=_3;if(this.adHocUI){this.addItem(this.adHocUI,0)}},getAdHocUI:function(){return this.adHocUI},saveAdHocUI:function(){isc.AI.showSaveUIWindow(this.response)},getAdHocUISummary:function(){return this.adHocUI&&this.adHocUI.getUISummary(["data"])},exportUI:function(){var _1=this.adHocUI.getFirstDBC();if(!_1){isc.logWarn("No exportable UI.");return}
var _2=isc.isA.ListGrid(_1),_3=isc.isA.FacetChart(_1),_4=[];if(_2){_4=[{title:"CSV",val:"csv"},{title:"JSON",val:"json"},{title:"XML",val:"xml"},{title:"XLS (Excel97)",val:"xls"},{title:"OOXML (Excel2007)",val:"ooxml"}]}else if(_3){_4=[{title:"PNG",val:"png"},{title:"JPEG",val:"jpeg"}]}
var _5=isc.Menu.create({autoDraw:false,items:_4,keepInParentRect:true,itemClick:function(_7){if(_2){if(_7.val=="json"){_1.exportClientData({operationId:"customJSONExport"})}else{_1.exportClientData({exportAs:_7.val})}}else if(_3){isc.RPCManager.exportImage(_1.getSvgString(),{exportDisplay:"download",exportFilename:"export",exportImageFormat:_7.val,exportImageQuality:1})}}})
_5.$91y();_5.draw();var _6=_5.getVisibleHeight();_5.placeNear(this.exportButton.getPageLeft(),this.exportButton.getPageTop()-_6);_5.show()}};isc.A.saveUIWindowDefaults={_constructor:"Window",width:300,autoCenter:true,autoSize:true,overflow:"visible",canDragResize:true,isModal:true,canDragReposition:true,title:"Save AI generated UI",bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},labelDefaults:{_constructor:"Label",width:"100%",height:1,overflow:"visible",dynamicContents:true,contents:"You can save AI-generated screens for later use.  Saved screens are available whenever you open the AI assistant.<br><br>What would you like to name this UI?<br>"},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:"*",colSpan:"*",showTitle:false,hint:"Type a name for your saved UI",showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.saveAdHocUI();return false}}}]},controlsLayoutDefaults:{_constructor:"HLayout",width:"100%",height:1,overflow:"visible",align:"right",membersMargin:8},saveButtonDefaults:{_constructor:"Button",title:"Save",autoFit:true,autoDraw:false,click:function(){this.creator.saveAdHocUI()},layoutAlign:"right"},cancelButtonDefaults:{_constructor:"Button",title:"Cancel",autoFit:true,autoDraw:false,click:function(){this.creator.hide();},layoutAlign:"right"},initWidget:function(){this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label"));this.addItem(this.addAutoChild("form"));this.addAutoChild("saveButton");this.addAutoChild("cancelButton");this.addItem(this.addAutoChild("controlsLayout",{members:[this.saveButton,this.cancelButton]}))},saveAdHocUI:function(){isc.AI.saveAdHocUI(this.form.getValue("userText"),this.response);this.hide()},closeClick:function(){this.hide()},setResponse:function(_1){this.response=_1},show:function(){this.form.setValue("userText",(isc.AI.lastUserPrompt||"").substring(0,100));return this.Super("show",arguments)}};isc.A.savedUIStorageKey="savedUI";isc.A.screensDataSource=null;isc.A.logLocalDSRequests=false;isc.A.assistantWindowDefaults={_constructor:"Window",width:500,autoCenter:true,autoSize:true,overflow:"visible",canDragResize:true,canDragReposition:true,title:"SmartClient AI Assistant",bodyProperties:{padding:10,layoutMargin:10,membersMargin:10},labelDefaults:{_constructor:"Label",width:"100%",dynamicContents:true,contents:"<b>Ask for AI assistance in using this ${isc.AI.isShowcase ? \"Showcase Sample\" : \"application\"}.</b><br><br>You can:<br><br>1. request that the AI configures the existing screen to do something you want (such as configuring complex search criteria for a grid)<br><br>2. request that the AI builds you a custom interface, to enable you to complete tasks more quickly than what the current UI allows. Note that AI-created screens may be saved for future use.<br>"},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:"*",colSpan:"*",showTitle:false,hint:"Type your question or request here",showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.askTheAI();return false}}}]},controlsLayoutDefaults:{_constructor:"HLayout",width:"100%",height:1,membersMargin:10,overflow:"visible"},savedUIFormDefaults:{_constructor:"DynamicForm",width:360,minWidth:200,height:1,overflow:"visible",autoFocus:false,autoDraw:false,cellPadding:0,layoutAlign:"left"},askButtonDefaults:{_constructor:"Button",title:"Ask the AI",autoFit:true,click:function(){this.creator.askTheAI()},layoutAlign:"right"},initWidget:function(){this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label"));this.addItem(this.addAutoChild("form"));this.addItem(this.addAutoChild("controlsLayout"));this.addAutoChild("savedUIForm",{fields:[{name:"savedUI",type:"select",width:"*",colSpan:"*",optionDataSource:isc.AI.getScreensDataSource(),valueField:"name",displayField:"name",title:"Saved Screens",wrapTitle:false,pickListProperties:{canRemoveRecords:true},changed:function(){this.form.creator.loadSavedUI(this.getValue());return false}}]});this.addAutoChild("askButton");this.controlsLayout.addMembers([this.savedUIForm,isc.LayoutSpacer.create({width:"*"}),this.askButton])},askTheAI:function(){var _1=this.form.getValue("userText")
isc.AI.command(_1,"userQuery");isc.Notify.addMessage("Asked the AI: \""+_1+"\"")},loadSavedUI:function(){var _1=this.savedUIForm.getValue("savedUI");isc.AI.getSavedUI(_1,function(_2){isc.AI.handleAIResponse(_2.response.aiResponse)})},close:function(){this.Super("close",arguments);isc.AI.assistantClosed()}};isc.A.clearHistoryOnClose=true;isc.A.clarifyWindowDefaults={_constructor:"Window",width:300,autoCenter:true,autoSize:true,canDragResize:true,canDragReposition:true,height:200,title:"The AI needs your input",bodyProperties:{padding:10,layoutMargin:10,membersMargin:9},labelContents:"",labelDefaults:{_constructor:"Label",width:"100%",height:1,contents:""},formDefaults:{_constructor:"DynamicForm",height:"*",autoFocus:true,cellPadding:0,fields:[{name:"userText",type:"textArea",minHeight:50,width:"*",height:80,colSpan:"*",showTitle:false,hint:"Type your clarifying information here",showHintInField:true,keyPress:function(_1,_2,_3,_4){if(_3=="Enter"){this.form.creator.tellTheAI();return false}}}]},aiButtonDefaults:{_constructor:"Button",title:"Tell the AI",autoFit:true,click:function(){this.creator.tellTheAI()},layoutAlign:"right"},initWidget:function(){this.Super("initWidget",arguments);this.addItem(this.addAutoChild("label"));this.addItem(this.addAutoChild("form"));this.addItem(this.addAutoChild("aiButton"))},tellTheAI:function(){var _1=this.form.getValue("userText")
isc.AI.command(_1,"userClarification");isc.AI.hideClarifyWindow()}};isc.A.aiModel="gpt-3.5-turbo";isc.A.initiatorPromptTemplate="This is an Isomorphic SmartClient AI Assistant Request (version 1.0).\n*** Overview ***\nFor an Isomorphic SmartClient AI Assistant Request, you are to act as an intelligent agent assisting a user in an Isomorphic SmartClient application.\nDetails of the application and the user request text will be provided at the end after this overview.\nYou should respond to this request with a response in the following structured format. Note that text in square brackets is descriptive. Any other text should be included verbatim:\n\nResponseType: [a response type, as explained below]\nMessage: [a message to be shown to the user, either explaining what you have done or asking for clarifications]\nMessageType: [a message type, as explained below]\n======\n[JavaScript code to perform a requested action when executed in the context of the SmartClient application. Note that the JavaScript should contained between a delineator of 6 equal signs, as shown here. Certain response types (described below) do not require any JavaScript code - in these cases the response may omit this entire block including both sets of equal signs.]\n======\n\n** Response Types **\nThere are six possible response types, described in the following section. \nNote that these are not listed in order of preference - you should choose the appropriate response type based on the prompt you received.\nImmediately after the numeral is the text value you should use for the \"ResponseType\" when responding. Do not include the numeral.\n\n1. Execute JavaScript\nProduce JavaScript code to do what the user wants, along with an explanation of what you have done, to be shown to the user.\nThis ResponseType is appropriate only to perform the same set of actions that a normal user can perform via the running SmartClient application's user interface, and any changes applied to the UI should be reversable by the user, using the UI.\nThis is typically limited to interacting with existing components on the page.\nThe JavaScript you generate should be valid JavaScript and may make use of the Isomorphic SmartClient JavaScript framework APIs.\n* Important Note *\nDetails of the currently visible UI of the application are below in the section titled \"SmartClient application and environment information\"Components listed in this summary may be accessed may be accessed directly by their \"ID\" property, or by passing this property into \"isc.Canvas.getById();\".\nOther documented SmartClient APIs may also be used.\nIf your code either causes a JavaScript error or times out, this will be reported to you.\nThe Message should be some text to display to the user, explaining what was done.\nThe MessageType may be set to either \"Notify\" or \"Modal Message\". MessageType \"Notify\" will show the message as a notification that auto-hides. MessageType \"Modal Message\" will show the message in a modal dialog that the user must explicitly dismiss before proceeding.\nSome examples of requested actions that would require an \"Execute JavaScript\" type response include:\n- Applying sorting to an existing listGrid via \"listGrid.sort();\" or \"listGrid.setSort();\"\n- Changing the filter criteria applied to an existing listGrid via \"listGrid.setFilterEditorCriteria();\" or \"listGridID.filterData();\"\n- Switching to a different tab in a TabSet via \"tabSet.selectTab();\"\nIf the user prompt requires a new UI be created, do not use the \"Execute JavaScript\" response type - use \"Ad Hoc UI\" instead.\n\n2. Ad Hoc UI\nYour generated JavaScript code creates an \"ad hoc\" UI to do whatever the user needs to do.  \nIn this case, the JavaScript code you specify should create SmartClient user interface components. The code will be captured in the same way that SmartClient captures \"screens\" (as in the RPCManager.loadScreen() API) and SmartClient will automatically display the result in a Window component. \nYour code does not need to include this Window component - just create the appropriate UI and it will be displayed to the user as appropriate.\nWhen the Window is closed, the ad-hoc UI created by your code will be destroyed (as in Canvas.destroy()).\nAs with \"Execute JavaScript\":\nThe code you generate should be valid JavaScript and may make use of the Isomorphic SmartClient JavaScript framework APIs.\nThe Message should be some text to display to the user, explaining what was done.\nThe MessageType may be set to either \"Notify\" or \"Modal Message\".\nThe \"Ad Hoc UI\" response type is appropriate for situations where the underlying DataSources provide the ability to achieve the end user's goals, but the UI does not provide an easy way to do what the user wants.  \nSome examples of requested actions that would require an \"Ad Hoc UI\" type response include:\n- Creating an aggregated view of dataSource data when none is available in the default UI. This could be achieved by creating a new ListGrid bound to the appropriate dataSource, and setting \"groupBy\" and  \"summaryFunctions\" on the \"dsRequest\" object passed to listGrid.filterData().\n- Displaying data from a dataSource in a chart by creating a new FacetChart bound to the dataSource, using the \"valuePrompt\" and \"facetFields\" to specify which attributes to chart, and calling fetchData() or filterData() to populate it.\nIn your other kinds of responses, if it's possible to create an ad-hoc UI to do what the user needs, be sure to mention that to the user.  And, if the user specifically requests an ad-hoc UI, take that as a suggestion to use this approach (unless another approach, such as \"Inspect\", is appropriate first).\n\n3. Clarify\nAsk the user for clarifying information.\nFor this type of response, the \"Message\" you specify can be used to ask the user a question. You should not show this message to the user - the application will show it in a modal dialog where the user may type in a response. The user's response will be sent back to you, allowing you to take further action.\nAny \"MessageType\" you specify will be ignored for \"Clarify\" type responses.\n\"Clarify\" type responses do not need to include any JavaScript, but if you do include JavaScript it will be executed in the scope of the application. This allows you to programatically gather information about the current application by using the \"isc.AI.commandComplete()\" method.\nIf you want to make use of this capability, consider the following points when generating your JavaScript code.\n- Your code should always include a call to the method \"isc.AI.commandComplete();\". This method takes a single argument, which can be any JavaScript object or primitive, and we will send this back to you (in addition to the user's response to your question). For example you could determine the current set of (visible) field names in a listGrid by calling \"isc.AI.commandComplete(listGrid.getFieldNames())\".\n- Your code can make use of asynchronous APIs; when your inspection code is complete, it should call the API isc.AI.commandComplete() method, passing any object that can be serialized to JSON. For an asynchronous action, this would typically be done in a callback function.\nFor example - if you wanted to find the total number of records in a DataSource, you could invoke\n  dataSource.fetchData(\n    // criteria - unrestricted fetch\n    null,\n    // callback function\n    function (dsResponse, data, dsRequest) {\n        isc.AI.commandComplete(dsResponse.totalRows);\n    },\n    // dsRequest configuration - use startRow and endRow to avoid returning actual records\n    { startRow:0, endRow:0 }\n  );\nIf you want to return information gathered from multiple APIs, you can combine all necessary information into a single JSON object which your code passes to isc.AI.commandComplete().\n\n4. Inspect\nGenerate JavaScript to gather information\nSimilar to the \"Clarify\" ResponseType explained above, you can generate JavaScript to gather information about the application environment, and have it sent back to you by calling \"isc.AI.commandComplete()\".\nUnlike \"Clarify\" responses, \"Inspect\" responses do not prompt the user for information.\nIf you do include a \"Message\", it will be displayed to the user as either a \"Notification\" or \"Modal Message\" depending on the \"MessageType\" you specified.\nIf necessary you may generate repeated \"Inspect\" type responses to gather multiple pieces of information about the application before finally deciding upon an interactive response to the user, via one of the other ResponseTypes.\n\n5. Send A Message\nThe \"Send A Message\" response type will cause the specified \"Message\" to be displayed to the user and take no other action.\nThis response type should not include an JavaScript to execute.\nThis is useful for cases where you simply want to display a message to the user.\n\n6. Explain Why Not\nExplain to the user that what they want cannot be done, and why.  \nIf possible, provide suggestions for how they might achieve their goals instead, including by contacting other people with administrative access to data.\nThe explanation you provide as the \"Message\" for this response type will appear in a modal SmartClient Window, with a text field below offering the user the ability to provide a revised or clarified command, or the ability to cancel the overall AI interaction.\nThis response type should not include any JavaScript to execute.\nYou should not show this message to the user - the application will show it, according to the MessageType you provide.\n\n** Example **\nAn example of a validly formatted response is below.\nThis response might be appropriate for the following user prompt:\n  \"Show the filterEditor on my listGrid and filter it to only show items that are less than $100 and customer's name contains 'Schwabb'\"\nIn this case we're assuming the application has a listGrid with the ID \"myListGrid\" with fields \"unitCost\" and \"customer\".\nExample response:\n\nResponseType: Execute JavaScript\nMessage: The filter editor for your listGrid has been displayed and the listGrid has been filtered to show only items with unitCost less than $100, where the customer name contains the string \"Schwabb\".\nMessageType: Notify\n======\nmyListGrid.setProperties({showFilterEditor:true});\nmyListGrid.filterData({\n    _constructor:\"AdvancedCriteria\",\n    operator:\"and\",\n    criteria:[\n        {fieldName:\"unitCost\", operator:\"lessThan\", value:100},\n        {fieldName:\"customer\", operator:\"iContains\", value:\"Schwabb\"},\n    ]\n});\n======\n\nDetails about the running application, and the user request are below.\n*** End of overview ***\n";isc.B.push(isc.A.getEngine=function isc_c_AI_getEngine(_1){_1=_1||isc.AI.defaultEngine;var _2=isc.AI.engines.find("name",_1)||{};return isc.addProperties({},_2)},isc.A.allowAssistant=function isc_c_AI_allowAssistant(){return true},isc.A.startAssistant=function isc_c_AI_startAssistant(_1){if(isc.AI.aiReady)return;if(!isc.AI.allowAssistant()){isc.logWarn("No AI engine API key found found.  Can't install AI.");return}
if(_1)isc.AI.assistantKey=_1;_1=isc.AI.assistantKey;var _2=isc.Page.getRegisteredKeyActions(_1);if(_2&&_2.length>0){isc.logWarn("Specified AI shortcut-key ("+JSON.stringify(_1)+") is already in use by another handler. To enable the AI assistant shortcut, call isc.AI.startAssistant() with an unused key-name.");return}
isc.Page.registerKey(_1,function(_1,_3){_3.showAssistant();return false},isc.AI);isc.AI.aiReady=true},isc.A.stopAssistant=function isc_c_AI_stopAssistant(){if(!isc.AI.aiReady){isc.AI.logWarn("Cannot stop the AI Assistant - it isn't running.");return}
isc.Page.unregisterKey(isc.AI.assistantKey,isc.AI);isc.AI.aiReady=false},isc.A.generateTextSummary=function isc_c_AI_generateTextSummary(_1,_2,_3,_4){var _5=_3&&_3.detail||"normal",_6=!!(_3&&_3.paraphrase),_7=_3&&_3.instructions,_8=_3&&_3.ignoreCache;var _9={text:_1,detail:_5,paraphrase:_6,instructions:_7};if(!_8){var _10=this.summaryCache.find(_9);if(_10!=null){if(_10.summary!=null){this.fireCallback(_2,"summaryText",[_10.summary]);return _10.summary}else{_10.callbacks.add(_2)}
return}}
if(_2!=null){_9.callbacks=[_2]}
if(!_8)this.summaryCache.add(_9);var _11;if(_7!=null){_11=_7.evalDynamicString(this,{value:_1})}else{var _12={detail:(_5=="normal"?"":_5)};_11=_6?this.requestAIParaphraseIntro:this.requestAISummaryIntro;_11=_11.evalDynamicString(this,_12)+_1}
var _13=this;var _14=function(_15){_13.retrievedAISummary(_15,_9)}
this.sendPrompt(_11,_14,_4)},isc.A.retrievedAISummary=function isc_c_AI_retrievedAISummary(_1,_2){_2.summary=_1||"";var _3=_2.callbacks;this.logWarn("Got here - "+_1+", callbacks:"+_3);for(var i=0;i<_3.length;i++){this.fireCallback(_3[i],"summaryText",[_1])}},isc.A.command=function isc_c_AI_command(_1,_2){if(_1==null)return;this.logWarn("Processing command of type "+_2);if(_2=="complete"){if(_1!=null){this.logWarn("Received 'complete' notification with prompt text:"+_1)}
return}
if(_2!="userQuery"&&_2!="resolveError"&&_2!="userClarification"){this.logWarn("This commandType is not yet supported");return}
if(_2=="userQuery"){isc.AI.lastUserPrompt=_1}
var _3=isc.AI.getSession(),_4=_3[0],_5=_3[1];if(_4==null&&this.useClientSessionHistory&&this.autoCreateDSType!="dummy"){_5={};_1=this.getInitiatorPrompt(_1,_5)}
function callback(_6,_7){isc.AI.handleAIResponse(_6,_7.clientContext)}
this.sendPrompt(_1,callback,{history:_4,clientContext:_5});this.addUserRequestToSessionHistory(_1,_5)},isc.A.sendPrompt=function isc_c_AI_sendPrompt(_1,_2,_3,_4){this.logInfo("Prompt text to send to AI:"+_1);var _5=this.getDataSource();if(_5==null){this.logWarn("AI dataSource not configured");return}
var _6="createChatCompletion";var _7={operationId:_6,willHandleError:true,clientContext:_3&&_3.context,showPrompt:_3&&_3.showPrompt};var _8=isc.AI.getEngine(_3&&_3.engine);var _9={model:_8.model,text:_1,history:_3&&_3.history};var _10=this;_5.fetchData(_9,function(_13,_14,_15){if(_13.status<0){if(_4>=_10.sendPromptMaxRetries){if(_13.status==-90){isc.say("Exception occurred attempting to contact the AI.<P>The server response is as follows:<P>"+_13.httpResponseText.asHTML())}else{isc.say("Exception occurred attempting to contact AI")}}else{if(_4==null)_4=0;var _11=_13.httpResponseText;isc.logWarn("Failed to receive response from AI: "+(_11?_11:"status "+_13.status),"AI");_10.delayCall("sendPrompt",[_1,_2,_3,++_4],_10.sendPromptRetryDelay)}
return}
var _12=_14&&_14[0]&&_14[0].chat_content;if(_12==null){isc.logWarn("Unable to extract message from AI response");return}
isc.logWarn("Response text from AI: "+_12,"AI");isc.AI.fireCallback(_2,"messageContent,config",[_12,_3])},_7)},isc.A.getVB=function isc_c_AI_getVB(){if(this.isReify)return window.VB;return null},isc.A.commandComplete=function isc_c_AI_commandComplete(_1){isc.Class.endAEM();if(this.isReify&&this.$2541){isc.AI.getVB().destroyProjectState(this.$2541)}
var _2=isc.AI.lastResponse||{};var _3=_1?isc.JSON.encode(_1):null;isc.logWarn("commandComplete() called - "+(_3?"JSON serialized to: "+_3:"no JSON to serialize"));if(_2.message&&!isc.isAn.emptyString(_2.message)){if(_2.messageType=="Notify")isc.Notify.addMessage(_2.message);else isc.say(_2.message)}
if(_3)isc.AI.command(_3,"complete")},isc.A.getSessionHistory=function isc_c_AI_getSessionHistory(){return this.getSession()[0]},isc.A.getSessionContext=function isc_c_AI_getSessionContext(){return this.getSession()[1]},isc.A.getSession=function isc_c_AI_getSession(){var _1=this.sessionHistory;var _2=this.sessionContext;return[_1,_2]},isc.A.clearSession=function isc_c_AI_clearSession(){delete this.sessionHistory;delete this.sessionContext},isc.A.addUserRequestToSessionHistory=function isc_c_AI_addUserRequestToSessionHistory(_1,_2){if(this.useClientSessionHistory){if(!this.sessionHistory)this.sessionHistory="";this.sessionHistory+="\n"+this.scPostDelineator+_1+this.scPostDelineator;if(_2!=null){if(this.sessionContext==null)this.sessionContext={};isc.addProperties(this.sessionContext,_2)}}},isc.A.addAIResponseToSessionHistory=function isc_c_AI_addAIResponseToSessionHistory(_1){if(this.useClientSessionHistory){var _2=isc.AI.cleanAIResponse(_1);if(!this.sessionHistory)this.sessionHistory="";this.sessionHistory+="\n"+this.aiResponseDelineator+_2+this.aiResponseDelineator}},isc.A.handleAIResponse=function isc_c_AI_handleAIResponse(_1,_2){this.addAIResponseToSessionHistory(_1);var _3=isc.AI.validateAIResponse(_1);this.handleValidatedAIResponse(_3,_2)},isc.A.handleValidatedAIResponse=function isc_c_AI_handleValidatedAIResponse(_1,_2){isc.AI.lastResponse=isc.addProperties({},_1);if(_1.errors&&_1.errors.length>0){this.logWarn("The following errors were found during response validation:"+this.echoAll(_1.errors));if(_1.unableToProcess){this.adjacentValidationFailureCount++;if(this.adjacentValidationFailureCount>4){isc.say("The AI is unable to process this request as written. Please try rephrasing your request.")}else{var _3="The reponse you shared with was not formatted correctly. Please rewrite the response in the specified format. The specific error(s) encountered are as follows:\n- "+_1.errors.join("\n- ");this.command(_3,"resolveError")}
return}}
this.adjacentValidationFailureCount=0;switch(_1.responseType){case"Execute JavaScript":var _4=isc.AI.handleAIJavaScript(_1,_2);break;case"Clarify":this.showClarifyWindow(_1.message);break;case"Inspect":var _4=isc.AI.handleAIJavaScript(_1,_2);break;case"Explain Why Not":case"Send A Message":var _4=isc.AI.commandComplete();break;case"Ad Hoc UI":var _4=isc.AI.handleAIJavaScript(_1,_2);break;default:}},isc.A.getErrorText=function isc_c_AI_getErrorText(_1,_2){return isc.AI.errorTypes[_1].evalDynamicString(this,_2)},isc.A.validateAIResponse=function isc_c_AI_validateAIResponse(_1){isc.logWarn("Raw AI response:: \n"+_1);var _2=[];var _3={};if(!_1||isc.isAn.emptyString(_1)){_2.add("No Response Content");_3.errors=_2;_3.unableToProcess=true;return _3}else{var _4=isc.AI.parseAIResponse(_1);_3=_4.response;var _5=_3.responseType;if(_4.aiResponse!=_1){_2.add(this.getErrorText("ContainsAIDelineator",_3))}
if(!_5||_5==""){_2.add(this.getErrorText("NoResponseType",_3));_3.unableToProcess=true}else if(!isc.AI.responseTypes.contains(_5)){_2.add(this.getErrorText("BadResponseType",_3));_3.unableToProcess=true}
if(_3.message){if(_5!="Clarify"){if(!_3.messageType){_2.add(this.getErrorText("NoMessageType",_3));_3.unableToProcess=true}else if(!isc.AI.messageTypes.contains(_3.messageType)){_2.add(this.getErrorText("BadMessageType",_3));_3.unableToProcess=true}}}
if(["Send A Message","Explain Why Not","Clarify"].contains(_3.messageType)){if(!_3.message||isc.isAn.emptyString(_3.message)){_2.add(this.getErrorText("NoMessage",_3));_3.unableToProcess=true}else if(_5!="Clarify"){if(!isc.AI.messageTypes.contains(_3.messageType)){_2.add(this.getErrorText("BadMessageType",_3));_3.unableToProcess=true}}}
if((_5=="Inspect"||_5=="Execute JavaScript")&&(!_3.javaScript||_3.javaScript.length==0)){_2.add(this.getErrorText("NoJavaScript",_3));_3.unableToProcess=true}
if(_3.noCommandComplete){if(_5=="Inspect"){_2.add(this.getErrorText("NoCommandComplete",_3));_3.unableToProcess=true}else if(_5=="Execute JavaScript"||_5=="Ad Hoc UI"){_3.fireCommandComplete=true}}}
if(_2.length>0)_3.errors=_2;_3.aiResponse=_1;isc.logInfo(isc.echoFull(_3));return _3});isc.evalBoundary;isc.B.push(isc.A.cleanAIResponse=function isc_c_AI_cleanAIResponse(_1){var _2=_1.replaceAll(isc.AI.exampleResponseDelineator,"").replaceAll(isc.AI.aiResponseDelineator,"").replaceAll(isc.AI.scPostDelineator,"");return _2},isc.A.parseAIResponse=function isc_c_AI_parseAIResponse(_1){var _2=this.cleanAIResponse(_1);var _3={};_3.responseType=this.retrieveAttributeValue("ResponseType:",_2);_3.messageType=this.retrieveAttributeValue("MessageType:",_2);_3.message=this.retrieveAttributeValue("Message:",_2,["MessageType:","======","ResponseType:"]);_3.javaScript=this.retrieveAttributeValue("======",_2,["======"]);if(_3.javaScript){var _4=new RegExp(/(isc\.AI\.commandComplete\()([\s\S]*?)(\))+/)
if(_3.javaScript.match(_4)==null){_3.noCommandComplete=true}}
return{response:_3,aiResponse:_2}},isc.A.retrieveAttributeValue=function isc_c_AI_retrieveAttributeValue(_1,_2,_3){var _4="(?:$|\\n)";if(_3!=null&&_3.length>0){_4="(?:$|\\n\\s*"+_3.join("|\\n\\s*")+")"}
var _5="(?:\\n|^)\\s*"+_1+"([\\s\\S]*?)"+_4;var _6=_2.match(new RegExp(_5));if(_6!=null)_6=_6.last().trim();return _6},isc.A.handleAIJavaScript=function isc_c_AI_handleAIJavaScript(_1,_2){if(this.isReify){this.$2541=isc.AI.getVB().getProjectState()}
var _3=_1.javaScript,_4=_1.responseType=="Ad Hoc UI",_5;if(_4)_5=isc.noAutoDraw=true;var _6=this;delete this.aemError;var _7=_2&&_2.idMapping;var _8;if(_7){_8={};for(var _9 in _7){var _10=isc.AutoTest.getLocatorCanvas(_7[_9][0]);if(_10!=null){_8[_9]=_10}}}
var _11=isc.Class.evaluateAICode(_3,function(_14){this.aemError=_14;if(_14.errorType=="Timeout"){_6.handleAEMTimeout()}else{_6.handleAEMError(_14.error)}},true,_4,_8);if(this.aemError){delete this.aemError;return}
if(_1.fireCommandComplete){this.commandComplete()}
if(_4){isc.AI.uiWindow=this.createAdHocUIWindow();var _12=_11.globals;var _13=isc.Canvas.$112q(_12,true);isc.AI.uiWindow.setAdHocUI(_13,_1);isc.AI.uiWindow.show()}},isc.A.handleAEMError=function isc_c_AI_handleAEMError(_1){this.resetApplicationState();this.logWarn("Error executing AI-generated script:"+_1);var _2=this.errorTypes["JavaScriptError"];var _3=_1.message,_4=this.getJSErrorHint(_3)||"";var _5=_2.evalDynamicString(this,{error:_1,hint:_4});this.$2542++;if(this.$2542>2){this.$2542=0;isc.say("The AI-generated script has caused an execution error. Please rephrase your request and try again.")}else{this.command(_5,"resolveError")}},isc.A.resetApplicationState=function isc_c_AI_resetApplicationState(){if(this.isReify&&this.$2541!=null){isc.AI.getVB().restoreProjectState(this.$2541);delete this.$2541}else{}},isc.A.getJSErrorHint=function isc_c_AI_getJSErrorHint(_1){var _2="";if(new RegExp("^\S+ is undefined").test(_1)){_2="\nSmartClient components are available by the ID in global scope. SmartClient classes may be accessed via their class name with the prefix \"isc.\" in global scope.\n"}
return _2},isc.A.handleAEMTimeout=function isc_c_AI_handleAEMTimeout(){this.logWarn("Timeout after executing AI-generated script - either the code flow failed to complete, or did not invoke AI.commandComplete() when it completed.")},isc.A.getDataSourceNames=function isc_c_AI_getDataSourceNames(){if(this.applicationDataSources!=null){var _1=[];for(var i=0;i<this.applicationDataSources.length;i++){var _3=this.applicationDataSources[i];if(isc.DataSource.get(_3)!=null){_1.add(_3)}}
return _1}
return(isc.AI.isReify?isc.AI.getVB().getProjectDataSourceNames():isc.DS.getRegisteredDataSourceObjects(true,true,true,true).getProperty("ID"))},isc.A.getDataSourceDefinitions=function isc_c_AI_getDataSourceDefinitions(_1){if(_1==null)_1="pseudocode";if(isc.AI.isReify){return isc.AI.getVB().getProjectDataSourceDefinitions(_1)}else{var _2=this.getDataSourceNames();if(_2&&_2.length>0){_2=_2.map(function(_3){return isc.DataSource.get(_3)})}
return isc.DS.getRegisteredDataSourceDefinitions(_1,false,_2)}},isc.A.getUISummary=function isc_c_AI_getUISummary(_1){var _2=this.applicationRootCanvas;if(_2==null){if(isc.AI.isReify){_2=isc.AI.getVB().rootComponent.children[0]}else if(isc.AI.isShowcase){var _3=window["featureExplorer_exampleViewer"];if(_3){if(_3.fullScreenExampleWindow&&_3.fullScreenExampleWindow.isDrawn()&&_3.fullScreenExampleWindow.isVisible())
{_2=_3.fullScreenExampleWindow.viewPane.viewContainer}else if(_3.viewPane&&_3.viewPane.isDrawn()&&_3.viewPane.isVisible()){_2=_3.viewPane.viewContainer}}}}
if(_2==null){var _4=isc.Canvas.$tw||[];for(var i=0;i<_4.length;i++){var _6=_4[i];if(_6==null)continue;if(isc.isA.ScreenSpan(_6))continue;if(!_6.isVisible()||!_6.isDrawn()){continue}
if(isc.isA.Menu(_6))continue;if(_6==isc.AI.assistantWindow)continue;if(_6.children!=null){_2=_6;break}}}
if(_2==null)return"";var _7=_2.getUISummary(["data"]);var _8={},_9=isc.JSON.encode(this.postProcessUISummary(_7,_8));return _1?[_9,_8]:_9},isc.A.postProcessUISummary=function isc_c_AI_postProcessUISummary(_1,_2){if(isc.isA.Array(_1)){for(var i=0;i<_1.length;i++){this.postProcessUISummary(_1[i],_2)}}else if(isc.isA.Object(_1)&&!isc.isA.Date(_1)){for(var _4 in _1){this.postProcessUISummary(_1[_4],_2)}}
var _5=_1&&_1.smartClientComponentType;if(_5!=null){_1.$eu=function(_10,_11,_12){var _5=this.smartClientComponentType;var _6={};var _7=this.id;var _8=window[_7];if(_8&&_8._autoAssignedID){var _9=_8.getLocalId();var i=0;_7=_9;while(_2[_7]!=null){_7=_9+"_"+(++i)}
_2[_7]=[isc.AutoTest.getObjectLocator(_8),_9,_8.getScreenId()]}
_6.ID=_7;isc.addProperties(_6,this);delete _6.$eu;delete _6.smartClientComponentType;delete _6.id;return"isc."+_5+".create("+isc.JSON.encode(_6,{prettyPrint:true,leadingIndent:_10})+")"}}
return _1},isc.A.createAdHocUIWindow=function isc_c_AI_createAdHocUIWindow(){return isc.Window.create(isc.AI.adHocUIWindowDefaults)},isc.A.showSaveUIWindow=function isc_c_AI_showSaveUIWindow(_1){if(!isc.AI.saveUIWindow){isc.AI.saveUIWindow=isc.Window.create(isc.AI.saveUIWindowDefaults)}
isc.AI.saveUIWindow.setResponse(_1);isc.AI.saveUIWindow.show();isc.AI.saveUIWindow.bringToFront()},isc.A.hideSaveUIWindow=function isc_c_AI_hideSaveUIWindow(){if(isc.AI.saveUIWindow)isc.AI.saveUIWindow.hide()},isc.A.getScreensDataSource=function isc_c_AI_getScreensDataSource(){if(!this.screensDataSource)this.screensDataSource=this.getLocalDataSource();return this.screensDataSource},isc.A.getLocalDataSource=function isc_c_AI_getLocalDataSource(){return this.$243t({transformRequest:function(_1){if(_1.doNotTrackRPC==null)_1.doNotTrackRPC=!isc.ss.logLocalDSRequests;return _1},_generated:true,storageMode:"allRecords",storageKey:this.savedUIStorageKey})},isc.A.$243t=function isc_c_AI__getLocalDataSource(_1){var _2=this;return isc.LocalDataSource.create(_1,{fields:[{name:"name",primaryKey:true},{name:"response",type:"text",length:1000000}],destroy:function(){return this.Super("destroy")}})},isc.A.saveAdHocUI=function isc_c_AI_saveAdHocUI(_1,_2){isc.AI.getScreensDataSource().addData({name:_1,response:_2});isc.say("Ad Hoc UI saved.")},isc.A.getSavedUI=function isc_c_AI_getSavedUI(_1,_2){isc.AI.getScreensDataSource().fetchData({name:_1},function(_3,_4,_5){if(isc.isAn.Array(_4))_4=_4[0];if(_2)_2(_4)})},isc.A.removeSavedUI=function isc_c_AI_removeSavedUI(_1){isc.AI.getScreensDataSource().removeData({name:_1})},isc.A.showAssistant=function isc_c_AI_showAssistant(){if(!isc.AI.assistantWindow){isc.AI.assistantWindow=isc.Window.create(isc.AI.assistantWindowDefaults)}
isc.AI.assistantWindow.show()},isc.A.hideAssistant=function isc_c_AI_hideAssistant(){if(isc.AI.assistantWindow)isc.AI.assistantWindow.close()},isc.A.assistantClosed=function isc_c_AI_assistantClosed(){if(this.clearHistoryOnClose&&this.useClientSessionHistory)this.clearSession()},isc.A.showClarifyWindow=function isc_c_AI_showClarifyWindow(_1){if(!isc.AI.clarifyWindow){isc.AI.clarifyWindow=isc.Window.create(isc.AI.clarifyWindowDefaults)}
var _2=isc.AI.clarifyWindow;_2.label.setContents(_1);_2.form.clearValues();_2.show()},isc.A.hideClarifyWindow=function isc_c_AI_hideClarifyWindow(){if(isc.AI.clarifyWindow)isc.AI.clarifyWindow.hide()},isc.A.getAIModel=function isc_c_AI_getAIModel(){return this.aiModel},isc.A.getDataSource=function isc_c_AI_getDataSource(){return this.dataSource},isc.A.getInitiatorPrompt=function isc_c_AI_getInitiatorPrompt(_1,_2){var _3=this.getDataSourceDefinitions();var _4=this.getUISummary(true);var _5=_4[0];if(_2!=null){_2.idMapping=_4[1]}
var _6=navigator.userAgent;var _7=this.initiatorPromptTemplate.evalDynamicString();_7+=this.getApplicationOverviewPrompt(_3,_5,_6);_7+="\n** User request **\n"+_1;return _7},isc.A.getApplicationOverviewPrompt=function isc_c_AI_getApplicationOverviewPrompt(_1,_2,_3){var _4="** SmartClient application and environment information **\n";if(this.isShowcase){_4+="The user is interacting with a sample application user interface with the following description:\n\n";_4+=featureExplorer_exampleDescription.getContents()+"\n\n"}
_4+="Partial code for the DataSources present in this application is below, with only important properties shown:\n";_4+=_1+"\n\n";_4+="Partial code for the currently visible UI of the application is below, with only important properties shown.\nComponents listed in this summary may be referenced directly by their \"ID\" property or by passing that ID to \"isc.Canvas.getById()\".\"\n\n"
_4+=_2+"\n\n";_4+="The SmartClient version is "+isc.version+"and the browser's userAgent is \""+_3+"\".\n";return _4},isc.A.handleAITransportError=function isc_c_AI_handleAITransportError(_1,_2,_3,_4){var _5=_1.URL||"";if(_5.startsWith("https://api.openai.com/")){return true}else{return false}});isc.B._maxIndex=isc.C+51;isc.AI.addMethods({})
isc.AI.addProperties({})
isc.AI.startAssistant(isc.AI.assistantKey);isc._nonDebugModules=(isc._nonDebugModules!=null?isc._nonDebugModules:[]);isc._nonDebugModules.push('AI');isc.checkForDebugAndNonDebugModules();isc._moduleEnd=isc._AI_end=(isc.timestamp?isc.timestamp():new Date().getTime());if(isc.Log&&isc.Log.logIsInfoEnabled('loadTime'))isc.Log.logInfo('AI module init time: '+(isc._moduleEnd-isc._moduleStart)+'ms','loadTime');delete isc.definingFramework;if(isc.Page)isc.Page.handleEvent(null,"moduleLoaded",{moduleName:'AI',loadTime:(isc._moduleEnd-isc._moduleStart)});}else{if(window.isc&&isc.Log&&isc.Log.logWarn)isc.Log.logWarn("Duplicate load of module 'AI'.");}
